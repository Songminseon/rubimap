<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>covid-map</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=2x2llshqtl"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>
<body>
  <div id="navbar">
    루비맵
  </div>
  <div id="search">
    <div>
      카테고리
    </div>
  </div>

  <!--
  <div id="detail_wrap">
    <div id="detail_content">
      
    </div>
  </div>
  -->
  <div id="infoBox">
   
  </div>
  <div id="map" style="width:100%;height:100vh;">
  </div>

  <script type="text/javascript" src="/data/data.js"></script>
  <script>
  
    var mapOptions = {
        center: new naver.maps.LatLng(37.540376,127.067581),
        zoom: 13
    };

    var map = new naver.maps.Map('map', mapOptions);

    var markerList = [];
    var infowindowList = [];
    var detailInfowindowList= [];

    for (var i in data){
      var target = data[i];
      var latlng = new naver.maps.LatLng(target.lat, target.lng);
      marker = new naver.maps.Marker({
        map:map,
        position: latlng,
        icon : {
          content : "<div class='marker'></div>",
          anchor : new naver.maps.Point(12,12)
        }
      });

      var content = `<div class='infowindow_wrap'>
        <div class='infowindow_title'>${target.name}</div>
        <div class='infowindow_content'>${target.open_time}</div>
        <div class='infowindow_date'>${target.phone}</div>
      </div>`

      var infowindow = new naver.maps.InfoWindow({
        content : content,
        backgroundColor : "#00ff0000",
        borderColor : "#00ff0000",
        anchorSize : new naver.maps.Size(0,0)
      })

      var content2 = `<div class="detail_wrap">
        <div class="detail_name">${target.name}</div>
        <div class="detail_category">${target.category}</div>
        <div class="detail_open_time" >${target.open_time}</div>
        <div class="detail_phone">${target.phone}</div>
        <div class="detail_description">${target.detail_description}</div>
      </div>`

      var detailInfo = new naver.maps.InfoWindow({
        content:content2,
        backgroundColor:"#00ff0011",
        borderColor:"#00ff0011",
        anchorSize:new naver.maps.Size(0,0)
      })

      markerList.push(marker);
      infowindowList.push(infowindow)
      detailInfowindowList.push(detailInfo)
    }

    for (var i=0, ii=markerList.length; i<ii; i++){
      naver.maps.Event.addListener(map, "click", ClickMap(i));
      naver.maps.Event.addListener(markerList[i], "click", getClickHandler(i));
      naver.maps.Event.addListener(infowindowList[i], "click", getDetailHandler(i));
    }

    

    function ClickMap(i){
      return function(){
        var infowindow=infowindowList[i]
        infowindow.close()
      }
    }

    function getClickHandler(i){
      return function(){
        var marker = markerList[i];
        var infowindow = infowindowList[i];
        if (infowindow.getMap()){
          infowindow.close()
        }
        else{
          infowindow.open(map, marker)
        }
      }
    }
    
    function getDetailHandler(i){
      return function(){ 
        var detailInfo = detailInfowindowList[i];
        var infowindow = infowindow[i];
        console.log(detailInfo)
        detailInfo.open(map, infowindow)
        console.log("11")
      }
    }

    console.log(detailInfowindowList)
    console.log(infowindowList)
    
  </script>
</body>
</html>